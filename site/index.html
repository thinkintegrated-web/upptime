<!doctype html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Think Integrated — Uptime Status</title>

    <!-- Bootstrap 5 (CSS) -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />

    <!-- Your overrides -->
    <link href="./style.css" rel="stylesheet" />
  </head>
  <body class="bg-body text-body">
    <header class="py-4 border-bottom bg-dark-subtle">
      <div class="container d-flex align-items-center justify-content-between">
        <div class="d-flex align-items-center gap-3">
          <!-- Optional logo -->
          <!-- <img src="https://yourcdn/logo.svg" alt="Think Integrated" height="36" /> -->
          <h1 class="h4 mb-0 fw-semibold">Think Integrated — Uptime</h1>
        </div>
        <small id="last-updated" class="text-secondary-emphasis"></small>
      </div>
    </header>

    <main class="container py-4">
      <section class="mb-4">
        <div class="p-3 p-md-4 border rounded-3 bg-dark-subtle">
          <h2 class="h5 mb-2">Live Status</h2>
          <p class="mb-0 text-secondary">
            This dashboard reflects current availability for monitored sites. Data is updated automatically by Upptime.
          </p>
        </div>
      </section>

      <section>
        <div class="card shadow-sm border-0">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h3 class="h6 mb-0">Monitored Sites</h3>
              <div class="input-group input-group-sm" style="max-width: 320px;">
                <span class="input-group-text">Search</span>
                <input id="search" type="search" class="form-control" placeholder="Type to filter…" />
              </div>
            </div>

            <div class="table-responsive">
              <table class="table table-dark table-striped align-middle" id="sites-table">
                <thead>
                  <tr>
                    <th scope="col">Status</th>
                    <th scope="col">Site</th>
                    <th scope="col" class="d-none d-sm-table-cell">Uptime (30d)</th>
                    <th scope="col" class="d-none d-md-table-cell">Response</th>
                    <th scope="col" class="d-none d-lg-table-cell">History</th>
                  </tr>
                </thead>
                <tbody id="sites-body">
                  <!-- populated by JS -->
                </tbody>
              </table>
            </div>

            <div id="empty-state" class="text-center py-4 d-none">
              <p class="text-secondary">No matching results.</p>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="py-4 mt-5 border-top bg-dark-subtle">
      <div class="container small text-secondary">
        Powered by <a class="link-light" href="https://github.com/upptime/upptime" target="_blank" rel="noreferrer">Upptime</a>.
      </div>
    </footer>

    <!-- Bootstrap 5 (JS) -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <script>
      // Defensive helpers — different Upptime versions have slightly different JSON shapes.
      const apiBase = "./api";

      async function loadSummary() {
        const res = await fetch(`${apiBase}/summary.json`, { cache: "no-store" });
        if (!res.ok) throw new Error("Failed to load summary.json");
        return res.json();
      }

      function badge(status) {
        const map = {
          up: "success",
          degraded: "warning",
          down: "danger",
        };
        const color = map[(status || "").toLowerCase()] || "secondary";
        return `<span class="badge rounded-pill text-bg-${color} text-capitalize">${status || "unknown"}</span>`;
      }

      function fmtMs(ms) {
        if (ms == null) return "—";
        return `${ms} ms`;
      }

      function fmtPct(n) {
        if (n == null) return "—";
        return `${(+n).toFixed(2)}%`;
      }

      function siteHistoryLink(slug) {
        // Each site gets its own history file (e.g., example-com.yml) and history page in default build.
        // Link to the YAML in /history for quick access (works in any baseUrl).
        return `./history/${slug}.yml`;
      }

      function renderTable(sites) {
        const tbody = document.getElementById("sites-body");
        tbody.innerHTML = sites
          .map((s) => {
            const name = s.name || s.url || s.slug || "Unknown";
            const url = s.url || "#";
            const slug = s.slug || (url ? url.replace(/https?:\/\//, "").replace(/[^\w]+/g, "-") : "unknown");
            const status = s.status || s.statusClass || "unknown";
            const uptime30 = s.uptimeMonth ?? s.uptime30d ?? s.uptime ?? null;
            const resp = s.responseTime ?? s.responseTimeDay ?? null;

            return `
              <tr data-name="${name.toLowerCase()} ${url.toLowerCase()}">
                <td style="white-space:nowrap;">${badge(status)}</td>
                <td>
                  <a href="${url}" class="link-light" target="_blank" rel="noreferrer">${name}</a>
                  <div class="small text-secondary">${url}</div>
                </td>
                <td class="d-none d-sm-table-cell">${fmtPct(uptime30)}</td>
                <td class="d-none d-md-table-cell">${fmtMs(resp)}</td>
                <td class="d-none d-lg-table-cell">
                  <a class="btn btn-sm btn-outline-light" href="${siteHistoryLink(slug)}">Open history</a>
                </td>
              </tr>
            `;
          })
          .join("");
      }

      (async function init() {
        try {
          const data = await loadSummary();
          // Try multiple known shapes:
          const sites =
            data.sites ||
            data.statuses ||
            (Array.isArray(data) ? data : []) ||
            [];
          renderTable(sites);

          // Updated timestamp
          const updated = data.updatedAt || data.lastUpdated || null;
          if (updated) {
            const el = document.getElementById("last-updated");
            el.textContent = `Last updated ${new Date(updated).toLocaleString()}`;
          }

          // Simple client-side filter
          const search = document.getElementById("search");
          const body = document.getElementById("sites-body");
          const empty = document.getElementById("empty-state");
          search.addEventListener("input", () => {
            const q = search.value.trim().toLowerCase();
            let visible = 0;
            [...body.querySelectorAll("tr")].forEach((row) => {
              const hay = row.getAttribute("data-name") || "";
              const show = hay.includes(q);
              row.classList.toggle("d-none", !show);
              if (show) visible++;
            });
            empty.classList.toggle("d-none", visible > 0);
          });
        } catch (e) {
          document.getElementById("sites-body").innerHTML =
            `<tr><td colspan="5"><div class="alert alert-danger mb-0">Failed to load status data.</div></td></tr>`;
          console.error(e);
        }
      })();
    </script>
  </body>
</html>
