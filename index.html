<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Status Dashboard</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 2rem;
      background: #fafafa;
      color: #222;
    }
    .sites-header {
      display: grid;
      grid-template-columns: 1.6fr .6fr .6fr .8fr;
      gap: .75rem;
      padding: .75rem 1rem;
      font-weight: 600;
      background: #f6f7f9;
      border: 1px solid #e3e6ea;
      border-radius: .5rem;
      margin: 1rem 0 .75rem;
    }
    .sites {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: .75rem;
    }
    .site-card {
      display: grid;
      grid-template-columns: 1.6fr .6fr .6fr .8fr;
      gap: .75rem;
      align-items: center;
      padding: 1rem;
      border: 1px solid #e3e6ea;
      border-radius: .75rem;
      background: #fff;
      transition: box-shadow .2s ease;
    }
    .site-card:hover { box-shadow: 0 2px 6px rgba(0,0,0,0.08); }
    .site-card .url { display: flex; align-items: center; gap: .5rem; }
    .pill { padding: .2rem .5rem; border-radius: 999px; font-size: .875rem; }
    .pill.up { background: #e8f7ee; color: #207d41; }
    .pill.down { background: #fde8e8; color: #b42318; }
    pre#debug {
      background: #111; color: #9fe;
      padding: 8px; border-radius: 6px;
      font-size: 12px; white-space: pre-wrap;
      margin-top: 16px; overflow-x: auto;
    }
  </style>
</head>
<body>

  <header class="sites-header">
    <div>URL</div><div>Status</div><div>Response</div><div>Uptime</div>
  </header>

  <section id="sites" class="sites"></section>

  <script>
    // For your repo path
    const basePath = "/uptime/history/";

    const debug = (msg) => {
      let box = document.getElementById('debug');
      if (!box) {
        box = document.createElement('pre');
        box.id = 'debug';
        document.body.appendChild(box);
      }
      box.textContent += (typeof msg === 'string' ? msg : JSON.stringify(msg, null, 2)) + '\n';
    };

    async function fetchJson(url) {
      try {
        const res = await fetch(url, { cache: 'no-store' });
        if (!res.ok) throw new Error(`${res.status} ${res.statusText}`);
        return await res.json();
      } catch (e) {
        debug(`Fetch failed: ${url} → ${e.message}`);
        return null;
      }
    }

    function statusPill(upNow) {
      const s = document.createElement('span');
      s.className = 'pill ' + (upNow ? 'up' : 'down');
      s.textContent = upNow ? 'Up' : 'Down';
      return s;
    }

    function renderCard(container, site) {
      const el = document.createElement('article');
      el.className = 'site-card';

      const url = document.createElement('div');
      url.className = 'url';
      const fav = document.createElement('img');
      fav.height = 13;
      fav.alt = '';
      try { fav.src = 'https://icons.duckduckgo.com/ip3/' + new URL(site.url).host + '.ico'; } catch {}
      const a = document.createElement('a');
      a.href = site.url;
      a.textContent = site.name || site.url;
      url.append(fav, a);

      const status = document.createElement('div');
      status.className = 'status';
      status.appendChild(statusPill(site.status === 'up'));

      const response = document.createElement('div');
      response.className = 'response';
      response.textContent = site.responseTime ? `${Math.round(site.responseTime)} ms` : '—';

      const uptime = document.createElement('div');
      uptime.className = 'uptime';
      uptime.textContent = site.uptime ? `${Number(site.uptime).toFixed(2)}%` : '—';

      el.append(url, status, response, uptime);
      container.appendChild(el);
    }

    (async function init() {
      const summary = await fetchJson(`${basePath}summary.json`);
      if (!summary) {
        debug('No summary.json found under /history/.');
        return;
      }

      const sites = Array.isArray(summary)
        ? summary
        : (summary.sites || []);
      const list = document.getElementById('sites');

      sites.forEach(site => {
        renderCard(list, {
          name: site.name || site.slug,
          url: site.url || site.site || '',
          status: site.status,
          responseTime: site.responseTime,
          uptime: site.uptime
        });
      });

      debug(`Loaded ${sites.length} sites from history/summary.json`);
    })();
  </script>
</body>
</html>
