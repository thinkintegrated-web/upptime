<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Status</title>
  <style>
    /* Put it where you want; these are just nice defaults */
    .sites-header { display:grid; grid-template-columns:1.6fr .6fr .6fr .8fr; gap:.75rem;
      padding:.75rem 1rem; font-weight:600; background:#f6f7f9; border:1px solid #e3e6ea;
      border-radius:.5rem; margin:1rem 0 .75rem }
    .sites { display:grid; grid-template-columns:repeat(auto-fit,minmax(320px,1fr)); gap:.75rem }
    .site-card { display:grid; grid-template-columns:1.6fr .6fr .6fr .8fr; gap:.75rem; align-items:center;
      padding:1rem; border:1px solid #e3e6ea; border-radius:.75rem; background:#fff }
    .site-card .url { display:flex; align-items:center; gap:.5rem }
    .pill { padding:.2rem .5rem; border-radius:999px; font-size:.875rem }
    .pill.up { background:#e8f7ee; color:#207d41 }
    .pill.down { background:#fde8e8; color:#b42318 }
  </style>
</head>
<body>

  <!-- YOU choose where this header lives -->
  <header class="sites-header">
    <div>URL</div><div>Status</div><div>Response</div><div>Uptime</div>
  </header>

  <!-- YOU choose where the cards list appears -->
  <section id="sites" class="sites"></section>

  <!-- Optional: put additional sections anywhere and populate them by ID -->
  <section id="fastest" style="margin-top:1.5rem;"></section>

  <template id="site-card-tpl">
    <article class="site-card">
      <div class="url"><img data-favicon height="13" alt="" /><a data-link></a></div>
      <div class="status"><span class="pill" data-status></span></div>
      <div class="response" data-response></div>
      <div class="uptime" data-uptime></div>
    </article>
  </template>

  <script>
    /**
     * Tell the page WHICH sites you want and WHERE their JSON lives.
     * slug = the folder name under /api/ (created by Upptime)
     * url  = the site URL you monitor
     * name = the label to display
     */
    const SITES = [
      { slug: "bhpchamber-org",     url: "https://www.bhpchamber.org",     name: "bhpchamber.org" },
      { slug: "blacktipit-com",     url: "https://www.blacktipit.com",     name: "blacktipit.com" },
      { slug: "ciaimaging-com",     url: "https://www.ciaimaging.com",     name: "ciaimaging.com" },
      // ...add the rest here (one line per monitored site)
    ];

    // If your repo is published at owner.github.io/repo, apiBase is "/repo/api"
    // If it’s at a custom domain at repo root, apiBase is just "/api"
    const apiBase = "/api";

    async function getSiteData(slug) {
      // Upptime usually exposes these JSON endpoints per site:
      //   /api/<slug>/status.json          -> latest status ("up"/"down"), code
      //   /api/<slug>/response-time.json   -> latest + history (ms)
      //   /api/<slug>/uptime.json          -> uptime % (overall / periods)
      const [status, resp, up] = await Promise.all([
        fetch(`${apiBase}/${slug}/status.json`).then(r => r.json()),
        fetch(`${apiBase}/${slug}/response-time.json`).then(r => r.json()),
        fetch(`${apiBase}/${slug}/uptime.json`).then(r => r.json()),
      ]);
      return { status, resp, up };
    }

    function renderCard(container, site, data) {
      const tpl = document.getElementById("site-card-tpl").content.cloneNode(true);
      const a = tpl.querySelector("[data-link]");
      const fav = tpl.querySelector("[data-favicon]");
      const statusEl = tpl.querySelector("[data-status]");
      const responseEl = tpl.querySelector("[data-response]");
      const uptimeEl = tpl.querySelector("[data-uptime]");

      a.href = site.url;
      a.textContent = site.name;
      fav.src = `https://icons.duckduckgo.com/ip3/${new URL(site.url).host}.ico`;

      const upNow = (data.status?.status ?? "").toLowerCase() === "up";
      statusEl.textContent = upNow ? "Up" : "Down";
      statusEl.classList.add(upNow ? "up" : "down");

      // response-time.json commonly has { average, last24h, daily: [...] } – fallback to any available number
      const lastMs = data.resp?.last24h ?? data.resp?.average ?? data.resp?.daily?.slice(-1)?.[0]?.value;
      responseEl.textContent = lastMs != null ? `${Math.round(lastMs)} ms` : "—";

      // uptime.json commonly has { overall, daily/weekly/monthly: [...] }
      const uptimePct = data.up?.overall ?? data.up?.weekly?.slice(-1)?.[0]?.uptime;
      uptimeEl.textContent = uptimePct != null ? `${Number(uptimePct).toFixed(2)}%` : "—";

      container.appendChild(tpl);
    }

    (async function init() {
      const list = document.getElementById("sites");

      // Populate the main list exactly where #sites sits
      for (const site of SITES) {
        try {
          const data = await getSiteData(site.slug);
          renderCard(list, site, data);
        } catch (e) {
          console.error("Failed to load", site.slug, e);
        }
      }

      // Example: populate another section elsewhere on the page
      // (You control placement by choosing the element you append into.)
      const fastest = document.getElementById("fastest");
      if (fastest) {
        // naive “fastest” example using already-rendered cards:
        const cards = Array.from(list.querySelectorAll(".site-card"));
        cards.sort((a, b) => {
          const ms = el => parseInt(el.querySelector("[data-response]").textContent) || Infinity;
          return ms(a) - ms(b);
        });
        if (cards.length) {
          const top = cards[0].cloneNode(true);
          fastest.innerHTML = "<h2>Fastest site right now</h2>";
          fastest.appendChild(top);
        }
      }
    })();
  </script>
</body>
</html>
